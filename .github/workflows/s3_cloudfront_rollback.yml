name: Rollback and Deploy to CloudFront
on:
   workflow_dispatch:
jobs:
  build-and-deploy:
    name: Rollback and Deploy
    runs-on: ubuntu-latest
    env:
      BUCKET: github-action-nginx
      DIST: build
      REGION: ap-south-1
      DIST_ID: E118ZAQXPR2IFW

    steps:
    - name: Checkout
      id: prev_tag  
      uses: actions/checkout@v3     #To fetch the history (including tags) from within a shallow clone
    - run: |
          git fetch --prune --unshallow  
          # echo "PREV_TAG=$(git describe --abbrev=0 --tags $(git rev-list --tags --skip=1 --max-count=1))" >> $GITHUB_OUTPUT
    
    - name: Checkout to Previous Tag 
      env:
        PREV_TAG: ${{ steps.prev_tag.outputs.prev_tag }}
      run: |
        git describe --abbrev=0 --tags $(git rev-list --tags --skip=1 --max-count=1)
        
    # - name: Configure AWS Credentials
    #   uses: aws-actions/configure-aws-credentials@v1
    #   with:
    #     aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #     aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #     aws-region: ${{ env.REGION }}

    # - uses: actions/setup-node@v2
    #   with:
    #     node-version: '12'

    # - name: Install Dependencies
    #   run: |
    #     node --version
    #     npm install

    # - name: Build Static Website
    #   run: npm run build

    # - name: Copy files to the production website with the AWS CLI
    #   run: |
    #     aws s3 sync --delete ${{ env.DIST }} s3://${{ env.BUCKET }}

    # - name: Copy files to the production website with the AWS CLI
    #   run: |
    #     aws cloudfront create-invalidation \
    #       --distribution-id ${{ env.DIST_ID }} \
    #       --paths "/*"
